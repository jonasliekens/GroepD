(function(e,t,n){var r,i=new t.maps.DirectionsRenderer,s=new t.maps.DirectionsService,o=t.maps.TravelMode.WALKING,u=new t.maps.LatLng(51.2192159,4.4028818),a,f=5e3,l=[],c,h,p=function(){c=e("#map_canvas");h=e("#map_error");r=new t.maps.Map(c.get(0),{center:u,zoom:9,mapTypeId:t.maps.MapTypeId.ROADMAP});i.setMap(r);i.setPanel(e("#directionsPanel").get(0));e.getJSON("rest/trips/"+c.data("trip-id")+"/stops",d);v();a=setInterval(v,f)},d=function(e){h.toggle(e.length<2);if(e.length<2)return!1;var n=e.shift(),r=e.pop(),u=[];for(var a in e)u.push({location:new t.maps.LatLng(e[a].latitude,e[a].longitude),stopover:!0});s.route({origin:new t.maps.LatLng(n.latitude,n.longitude),destination:new t.maps.LatLng(r.latitude,r.longitude),waypoints:u,travelMode:o},function(e,n){n===t.maps.DirectionsStatus.OK&&i.setDirections(e)})},v=function(){e.getJSON("rest/trips/participants/started",{tripId:c.data("trip-id")},m)},m=function(e){var i,s=[];for(var o in l)s.push(o);for(var o=0;o<e.length;o++)l[e[o].id]!==n&&s.splice(s.indexOf(e[o].id),1);for(var o=0;o<s.length;o++){l[s[o]].setMap(null);l.splice(s[o],1)}for(var o=0;o<e.length;o++){i=new t.maps.LatLng(e[o].latitude,e[o].longitude);l[e[o].id]===n?l[e[o].id]=new t.maps.Marker({position:i,map:r,zIndex:99}):l[e[o].id].setPosition(i)}};e(p)})(window.jQuery,window.google);